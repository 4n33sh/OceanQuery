<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>FloatChat - Oceanography GPT</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family: Inter, sans-serif; background: linear-gradient(to right, #e6f7ff, #f0faff); transition: background 0.3s;}
  .side { width: 230px; }
  .chat-area { flex: 1; display:flex; flex-direction:column; }
  .message { padding:8px 12px; border-radius:12px; margin-bottom:4px; max-width:75%; box-shadow:0 2px 4px rgba(0,0,0,0.08);}
  .from-user { background:#cce5ff; align-self:flex-end; border:1px solid #99d6ff;}
  .from-bot { background:#f8f9fa; align-self:flex-start; border:1px solid #e2e3e5;}
  .card { border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.08);}
  #userInput { border-radius:10px; border:1px solid #99d6ff;}
  #history { overflow-y:auto; flex-grow:1; }
  .history-item { padding:8px 12px; margin-bottom:6px; border-radius:12px; cursor:pointer; font-size:0.9rem; background:#e6f2ff; border:1px solid #cce5ff; transition:all 0.2s; text-align:left;}
  .history-item:hover { background:#cce5ff; }
  .dark-mode { background:#121212; color:#eee; }
  .dark-mode .card, .dark-mode .history-item { background:#1e1e1e; color:#eee; border-color:#333; }
  .dark-mode .from-user { background:#155e75; color:#fff; border:1px solid #0d3c4d; }
  .dark-mode .from-bot { background:#2a2a2a; color:#fff; border:1px solid #3a3a3a; }
  #sendBtn { background: linear-gradient(135deg, #0d6efd, #47a3ff); border:none; border-radius:10px;}
  #sendBtn:hover { transform:scale(1.05); box-shadow:0 3px 10px rgba(0,0,0,0.2);}
  .loader { border: 4px solid #f3f3f3; border-top:4px solid #0d6efd; border-radius:50%; width:20px; height:20px; animation:spin 1s linear infinite; display:inline-block; margin-right:6px;}
  @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="container-fluid p-3" id="root">
  <div class="d-flex" style="height:85vh;">
    <!-- Sidebar -->
    <div class="d-flex flex-column side me-3">
      <h5>Chat History</h5>
      <div id="history"></div>
      <button class="btn btn-sm btn-primary mb-2 rounded-pill shadow-sm" id="new-chat">+ New Chat</button>
      <div class="card p-2">
        <h6>Settings</h6>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="darkToggle">
          <label class="form-check-label" for="darkToggle">Dark Mode</label>
        </div>
      </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
      <div class="card mb-2 p-3 flex-grow-1 d-flex flex-column">
        <div id="analysisText" class="flex-grow-1 d-flex flex-column"></div>
        <div class="mt-auto d-flex gap-2">
          <input id="userInput" class="form-control" placeholder="Type query here..."/>
          <button id="sendBtn" class="btn btn-primary">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
let chatHistory = [];
let currentChatId = 0;

function renderMessage(content, fromBot=true) {
    $('#analysisText').append(
        $('<div>').addClass('message').addClass(fromBot ? 'from-bot' : 'from-user').html(content)
    );
}

function sendQuery(){
  const q = $('#userInput').val().trim();
  if(!q) return;

  renderMessage(q, false);
  $('#userInput').val("");

  // show indefinite loader
  renderMessage('<div><span class="loader"></span>Analyzing...</div>', true);
}

// Event bindings
$('#sendBtn').on('click', sendQuery);
$('#userInput').on('keypress', function(e) { if(e.which === 13) sendQuery(); });

// Dark mode toggle
$('#darkToggle').on('change', function() {
    $('body').toggleClass('dark-mode', this.checked);
});

// New chat functionality
$('#new-chat').on('click', function() {
    const chatContent = $('#analysisText').html();
    if(chatContent.trim() !== "") {
        const btn = $('<button>')
            .addClass('btn btn-sm mb-2 history-item w-100')
            .text(`Chat ${currentChatId+1}`)
            .data('chatId', currentChatId);
        $('#history').prepend(btn);
        chatHistory[currentChatId] = chatContent;
        currentChatId++;
    }
    $('#analysisText').empty();
});

// Click history chat to reload
$('#history').on('click', '.history-item', function() {
    const chatId = $(this).data('chatId');
    if(chatHistory[chatId]) {
        $('#analysisText').html(chatHistory[chatId]);
    }
});
</script>
</body>
</html>
